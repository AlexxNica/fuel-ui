<div class="wrapper">
  <h3>Network Settings</h3>

  <% var disabled = task ? 'disabled' : '' %>

  <% if (networks) { %>

    <% var managers = {'FlatDHCPManager': 'FlatDHCP Manager', 'VlanManager': 'VLAN Manager'} %>
    <div class="radio-checkbox-group net-manager">
      <% _.each(_.keys(managers), function(manager) { %>
        <div class="item-box">
          <label class="parameter-box clearfix">
            <div class="parameter-control">
              <div class="custom-tumbler">
                <input type="radio" value="<%= manager %>" name="net-manager" <%= net_manager == manager ? 'checked' : '' %> <%= disabled %>>
                <!--[if !IE |(gte IE 9)]>--><span>&nbsp;</span><!--<![endif]-->
              </div>
            </div>
            <div class="parameter-name"><%= managers[manager] %></div>
          </label>
        </div>
      <% }) %>
    </div>
    <hr>

    <div class="networks-table">
      <% _.each(networks.models, function(network) { %>

        <% var networkName = network.get('name') %>
        <legend class="networks"><%- networkName != 'fixed' ? networkName : 'VM Networks (Fixed)' %></legend>

        <% var vlanManager = net_manager == 'VlanManager' ? '' : 'hide' %>
        <% var visibleAttributes = {
          'floating': ['ip_ranges', 'vlan_start'],
          'public': ['ip_ranges', 'vlan_start', 'netmask', 'gateway'],
          'management': ['cidr', 'vlan_start'],
          'storage': ['cidr', 'vlan_start'],
          'fixed': ['cidr', 'amount', 'network_size', 'vlan_start']
        } %>
        <% var labels = {
          'ip_ranges': 'IP Range',
          'vlan_start': 'VLAN ID',
          'netmask': 'Netmask',
          'gateway': 'Gateway',
          'cidr': 'CIDR',
          'amount': 'Amount of Networks',
          'network_size': 'Size of Networks',
          'vlan_range': 'VLAN ID range'
        } %>

        <div data-network-id="<%- network.id %>" class="<%- networkName %>">
          <% _.each(_.keys(network.attributes), function(attribute) { %>
            <% var hidden = _.contains(visibleAttributes[networkName], attribute) ? '' : 'hide' %>
            <% if (attribute == 'ip_ranges') { %>
              <div class="range-row-header <%= hidden %>">
                <div>Start</div><div>End</div>
              </div>
              <div class="networks-sub-title parameter-name range-name <%= hidden %>"><%= labels[attribute] %></div>
              <% _.each(network.get(attribute), function(ip_range) { %>
                <div class="range-row clearfix <%= hidden %>">
                  <label class="parameter-box clearfix setting">
                    <div class="parameter-control <%- attribute %>">
                      <input type="text" name="<%- networkName %>-<%- attribute %>-start" placeholder="127.0.0.1" value="<%- _.first(ip_range) %>" <%= disabled %> />
                    </div>
                  </label>
                  <label class="parameter-box clearfix setting">
                  <div class="parameter-control <%- attribute %>">
                    <input type="text" name="<%- networkName %>-<%- attribute %>-end" placeholder="127.0.0.1" value="<%- _.last(ip_range) %>" <%= disabled %> />
                  </div>
                  </label>
                  <div class="ip-ranges-control">
                    <button class="btn btn-link ip-ranges ip-ranges-add"><i class="icon-plus-circle"></i></button>
                  </div>
                  <% if (network.get(attribute).length > 1) { %>
                    <div class="ip-ranges-control">
                      <button class="btn btn-link ip-ranges ip-ranges-delete"><i class="icon-minus-circle"></i></button>
                    </div>
                  <% } %>
                  <div class="error"><span class="help-inline"></span></div>
                </div>
              <% }) %>
            <% } else if (_.contains(['vlan_start', 'netmask', 'gateway', 'cidr', 'amount'], attribute)) { %>
              <% if (networkName == 'fixed' && attribute == 'vlan_start' && !vlanManager) { %>
                <div class="range-row-header mini <%= hidden %>">
                  <div>Start</div><div>End</div>
                </div>
                <label class="parameter-box clearfix setting">
                  <div class="networks-sub-title parameter-name"><%= labels.vlan_range %></div>
                  <div class="range-row">
                    <div class="parameter-control vlan_start">
                      <input type="text" class="mini range" name="fixed-vlan_range-start" value="<%- network.get('vlan_start') %>" <%= disabled %> />
                    </div>
                    <div class="parameter-control vlan_end">
                      <input type="text" class="mini" name="fixed-vlan_range-end" value="<%= network.get('vlan_start') + network.get('amount') - 1 %>" disabled />
                    </div>
                    <div class="error"><span class="help-inline"></span></div>
                  </div>
                </label>
              <% } else { %>
                <label class="parameter-box clearfix setting <%= hidden %> <%= vlanManager && attribute == 'amount' ? 'hide' : '' %>">
                  <div class="networks-sub-title parameter-name"><%= labels[attribute] %></div>
                  <div class="parameter-control <%- attribute %>">
                    <input type="text" class="<%= !vlanManager && attribute == 'amount' ? 'range' : '' %>" name="<%- networkName %>-<%- attribute %>" value="<%- networkName == 'floating' && attribute == 'vlan_start' ? networks.findWhere({name: 'public'}).get(attribute) : network.get(attribute) %>" <%= disabled || networkName == 'floating' ? 'disabled' : '' %> />
                  </div>
                  <div class="error"><span class="help-inline"></span></div>
                </label>
              <% } %>
            <% } else if (attribute == 'network_size') { %>
              <label class="parameter-box clearfix setting <%= hidden %> <%= vlanManager %>">
                <div class="networks-sub-title parameter-name"><%= labels[attribute] %></div>
                <div class="parameter-control <%- attribute %>">
                  <select name="<%- networkName %>-<%- attribute %>" <%= disabled %>>
                    <% _.each([4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048], function(size) { %>
                      <option value="<%= size %>" <%= network.get('network_size') == size ? 'selected' : '' %>><%= size %></option>
                    <% }) %>
                  </select>
                </div>
                <div class="error"><span class="help-inline"></span></div>
              </label>
            <% } %>
          <% }) %>
        </div>
      <% }) %>
    </div>

  <% } else { %>
    <div class="row row-fluid">
      <div class="span4"></div>
      <div class="span4">
        <div class="progress progress-striped progress-success active">
          <div class="bar" style="width: 100%"></div>
        </div>
      </div>
    </div>
  <% } %>

  <!-- Verification control -->
  <hr>
  <div class="row verification-control"></div>

  <!-- Buttons -->
  <div class="row">
    <div class="page-control-box">
      <div class="page-control-button-placeholder">
        <button class="btn verify-networks-btn" <%= disabled %>>Verify Networks</button>
        <button class="btn btn-revert-changes" <%= !hasChanges || disabled ? 'disabled' : '' %>>Cancel Changes</button>
        <button class="btn btn-success apply-btn" <%= !hasChanges || disabled ? 'disabled' : '' %>>Save Settings</button>
      </div>
    </div>
  </div>
</div>
